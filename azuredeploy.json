{
"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
"contentVersion": "1.0.0.0",
"parameters": {
    "clusterName": {
    "type": "string",
    "metadata": {
        "description": "The name of the HDInsight cluster to create."
    }
    },
    "clusterLoginUserName": {
    "type": "string",
    "defaultValue": "admin",
    "metadata": {
        "description": "These credentials can be used to submit jobs to the cluster and to log into cluster dashboards."
    }
    },
    "clusterLoginPassword": {
    "type": "securestring",
    "metadata": {
        "description": "The password must be at least 10 characters in length and must contain at least one digit, one non-alphanumeric character, and one upper or lower case letter."
    }
    },
    "sshUserName": {
    "type": "string",
    "defaultValue": "sshuser",
    "metadata": {
        "description": "These credentials can be used to remotely access the cluster."
    }
    },
    "sshPassword": {
    "type": "securestring",
    "metadata": {
        "description": "The password must be at least 10 characters in length and must contain at least one digit, one non-alphanumeric character, and one upper or lower case letter."
    }
    },
    "location": {
    "type": "string",
    "defaultValue": "East US",
    "allowedValues": [
        "East US",
        "East US 2",
        "North Central US",
        "South Central US",
        "West US",
        "North Europe",
        "West Europe",
        "East Asia",
        "Southeast Asia",
        "Japan East",
        "Japan West",
        "Australia East",
        "Australia Southeast"
    ],
    "metadata": {
        "description": "The location where all azure resources will be deployed."
    }
    },
    "clusterType": {
    "type": "string",
    "defaultValue": "hadoop",
    "allowedValues": [
        "hadoop",
        "hbase",
        "storm",
        "spark"
    ],
    "metadata": {
        "description": "The type of the HDInsight cluster to create."
    }
    },
    "clusterWorkerNodeCount": {
    "type": "int",
    "defaultValue": 2,
    "metadata": {
        "description": "The number of nodes in the HDInsight cluster."
    }
    }
},
"variables": {
    "defaultApiVersion": "2015-05-01-preview",
    "clusterApiVersion": "2015-03-01-preview",
    "clusterStorageAccountName": "[concat(parameters('clusterName'),'store')]"
},
"resources": [
    {
    "name": "[variables('clusterStorageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "location": "[parameters('location')]",
    "apiVersion": "[variables('defaultApiVersion')]",
    "dependsOn": [ ],
    "tags": { },
    "properties": {
        "accountType": "Standard_LRS"
    }
    },
    {
    "name": "[parameters('clusterName')]",
    "type": "Microsoft.HDInsight/clusters",
    "location": "[parameters('location')]",
    "apiVersion": "[variables('clusterApiVersion')]",
    "dependsOn": [ "[concat('Microsoft.Storage/storageAccounts/',variables('clusterStorageAccountName'))]" ],
    "tags": {

    },
    "properties": {
        "clusterVersion": "3.4",
        "osType": "Linux",
        "tier": "standard",
        "clusterDefinition": {
        "kind": "[parameters('clusterType')]",
        "configurations": {
            "gateway": {
            "restAuthCredential.isEnabled": true,
            "restAuthCredential.username": "[parameters('clusterLoginUserName')]",
            "restAuthCredential.password": "[parameters('clusterLoginPassword')]"
            },
            "hive-site": {
                "javax.jdo.option.ConnectionDriverName": "com.microsoft.sqlserver.jdbc.SQLServerDriver",
                "javax.jdo.option.ConnectionURL": "jdbc:sqlserver://myadla0901dbserver.database.windows.net;database=myhive20160901;encrypt=true;trustServerCertificate=true;create=false;loginTimeout=300",
                "javax.jdo.option.ConnectionUserName": "johndole",
                "javax.jdo.option.ConnectionPassword": "myPassword$"
            },
            "hive-env": {
                "hive_database": "Existing MSSQL Server database with SQL authentication",
                "hive_database_name": "myhive20160901",
                "hive_database_type": "mssql",
                "hive_existing_mssql_server_database": "myhive20160901",
                "hive_existing_mssql_server_host": "myadla0901dbserver.database.windows.net",
                "hive_hostname": "myadla0901dbserver.database.windows.net"
            },
            "oozie-site": {
                "oozie.service.JPAService.jdbc.driver": "com.microsoft.sqlserver.jdbc.SQLServerDriver",
                "oozie.service.JPAService.jdbc.url": "jdbc:sqlserver://myadla0901dbserver.database.windows.net;database=myhive20160901;encrypt=true;trustServerCertificate=true;create=false;loginTimeout=300",
                "oozie.service.JPAService.jdbc.username": "johndole",
                "oozie.service.JPAService.jdbc.password": "myPassword$",
                "oozie.db.schema.name": "oozie"
            },
            "oozie-env": {
                "oozie_database": "Existing MSSQL Server database with SQL authentication",
                "oozie_database_name": "myhive20160901",
                "oozie_database_type": "mssql",
                "oozie_existing_mssql_server_database": "myhive20160901",
                "oozie_existing_mssql_server_host": "myadla0901dbserver.database.windows.net",
                "oozie_hostname": "myadla0901dbserver.database.windows.net"
            }            
        }
        },
        "storageProfile": {
        "storageaccounts": [
            {
            "name": "[concat(variables('clusterStorageAccountName'),'.blob.core.windows.net')]",
            "isDefault": true,
            "container": "[parameters('clusterName')]",
            "key": "[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('clusterStorageAccountName')), variables('defaultApiVersion')).key1]"
            }
        ]
        },
        "computeProfile": {
        "roles": [
            {
            "name": "headnode",
            "targetInstanceCount": "2",
            "hardwareProfile": {
                "vmSize": "Standard_D3"
            },
            "osProfile": {
                "linuxOperatingSystemProfile": {
                "username": "[parameters('sshUserName')]",
                "password": "[parameters('sshPassword')]"
                }
            }
            },
            {
            "name": "workernode",
            "targetInstanceCount": "[parameters('clusterWorkerNodeCount')]",
            "hardwareProfile": {
                "vmSize": "Standard_D3"
            },
            "osProfile": {
                "linuxOperatingSystemProfile": {
                "username": "[parameters('sshUserName')]",
                "password": "[parameters('sshPassword')]"
                }
            }
            }
        ]
        }
    }
    }
],
"outputs": {
    "cluster": {
    "type": "object",
    "value": "[reference(resourceId('Microsoft.HDInsight/clusters',parameters('clusterName')))]"
    }
}
}
